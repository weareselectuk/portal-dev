{"version":3,"sources":["../es6/wds-metabox-analysis.js"],"names":["$","window","Wds","MetaboxAnalysisHelper","get_focus_keyword_el","val","get_seo_analysis_el","get_readability_analysis_el","new_report","get_seo_report_el","replaceWith","get_readability_report_el","new_fields","get_postbox_fields_el","get_metabox_el","enable","get_refresh_button_el","attr","data","$el","$container","get_analysis_containers","addClass","is","hide","show","prop","removeClass","focusValid","get_focus_container_el","MetaboxAnalysis","editor","postEditor","init","addEventListener","refresh_analysis","document","on","e","handle_refresh_click","handle_ignore_click","handle_unignore_click","_","debounce","handle_focus_keywords_change","hook_meta_change_listener","handle_page_load","focusKeyword","get_focus_keyword","post","post_id","get_data","is_dirty","is_post_dirty","wds_title","get_title","wds_description","get_description","wds_focus_keywords","done","response","success","seo_report","seo","readability_report","readability","post_fields","postbox_fields","replace_seo_report","replace_readability_report","replace_post_fields","seo_errors","get_seo_error_count","readability_state","get_readability_state","dispatch_seo_update_event","dispatch_readability_update_event","always","unblock_ui","length","update_focus_field_state","update_refresh_button","prevent_default","dispatch_event","block_ui","autosave","$button","target","closest","check_id","change_ignore_status","metaboxOnpage","action","extend","_wds_nonce","_wds_metabox_analysis","nonce","ajaxurl","ignore","event","preventDefault","stopPropagation","dispatchEvent","Event","error_count","CustomEvent","detail","errors","state","EventTarget","metaboxAnalysis","jQuery"],"mappings":"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","sourcesContent":["(function ($) {\n\twindow.Wds = window.Wds || {};\n\n\tclass MetaboxAnalysisHelper {\n\t\tstatic get_focus_keyword_el() {\n\t\t\treturn $('#wds_focus');\n\t\t}\n\n\t\tstatic get_focus_keyword() {\n\t\t\treturn this.get_focus_keyword_el().val();\n\t\t}\n\n\t\tstatic get_title() {\n\t\t\treturn $('#wds_title').val();\n\t\t}\n\n\t\tstatic get_description() {\n\t\t\treturn $('#wds_metadesc').val();\n\t\t}\n\n\t\tstatic get_metabox_el() {\n\t\t\treturn $(\"#wds-wds-meta-box\");\n\t\t}\n\n\t\tstatic get_seo_report_el() {\n\t\t\treturn $('.wds-seo-analysis', this.get_seo_analysis_el());\n\t\t}\n\n\t\tstatic get_readability_report_el() {\n\t\t\treturn $(\".wds-readability-report\", this.get_readability_analysis_el());\n\t\t}\n\n\t\tstatic get_postbox_fields_el() {\n\t\t\treturn $('.wds-post-box-fields');\n\t\t}\n\n\t\tstatic replace_seo_report(new_report) {\n\t\t\tthis.get_seo_report_el().replaceWith(new_report);\n\t\t}\n\n\t\tstatic replace_readability_report(new_report) {\n\t\t\tthis.get_readability_report_el().replaceWith(new_report);\n\t\t}\n\n\t\tstatic replace_post_fields(new_fields) {\n\t\t\tthis.get_postbox_fields_el().replaceWith(new_fields);\n\t\t}\n\n\t\tstatic get_refresh_button_el() {\n\t\t\treturn $(\".wds-refresh-analysis\", this.get_metabox_el());\n\t\t}\n\n\t\tstatic update_refresh_button(enable) {\n\t\t\tthis.get_refresh_button_el().attr('disabled', !enable)\n\t\t}\n\n\t\tstatic get_seo_error_count() {\n\t\t\treturn this.get_seo_report_el().data('errors');\n\t\t}\n\n\t\tstatic get_readability_state() {\n\t\t\treturn this.get_readability_report_el().data('readabilityState');\n\t\t}\n\n\t\tstatic get_seo_analysis_el() {\n\t\t\treturn $('.wds-seo-analysis-container', this.get_metabox_el());\n\t\t}\n\n\t\tstatic get_readability_analysis_el() {\n\t\t\treturn $('.wds-readability-analysis-container', this.get_metabox_el());\n\t\t}\n\n\t\tstatic block_ui($el = false) {\n\t\t\tlet $container = this.get_analysis_containers();\n\n\t\t\tif ($el) {\n\t\t\t\t$el.addClass($el.is('button') ? 'sui-button-onload' : 'wds-item-loading');\n\t\t\t} else {\n\t\t\t\t$('.wds-report-inner', $container).hide();\n\t\t\t\t$('.wds-analysis-working', $container).show();\n\t\t\t}\n\n\t\t\t$('.wds-disabled-during-request', $container).prop('disabled', true);\n\t\t}\n\n\t\tstatic unblock_ui() {\n\t\t\tlet $container = this.get_analysis_containers();\n\n\t\t\t$('.wds-item-loading', $container).removeClass('wds-item-loading');\n\t\t\t$('.sui-button-onload', $container).removeClass('sui-button-onload');\n\t\t\t$('.wds-report-inner', $container).show();\n\t\t\t$('.wds-analysis-working', $container).hide();\n\t\t\t$('.wds-disabled-during-request', $container).prop('disabled', false);\n\t\t}\n\n\t\tstatic get_analysis_containers() {\n\t\t\treturn $('.wds-seo-analysis-container, .wds-readability-analysis-container', this.get_metabox_el());\n\t\t}\n\n\t\tstatic update_focus_field_state(focusValid) {\n\t\t\tthis.get_focus_container_el()\n\t\t\t\t.removeClass('wds-focus-keyword-loaded wds-focus-keyword-invalid')\n\t\t\t\t.addClass(focusValid ? 'wds-focus-keyword-loaded' : 'wds-focus-keyword-invalid');\n\t\t}\n\n\t\tstatic get_focus_container_el() {\n\t\t\treturn $('.wds-focus-keyword');\n\t\t}\n\t}\n\n\tclass MetaboxAnalysis extends EventTarget {\n\t\tconstructor() {\n\t\t\tsuper();\n\n\t\t\tthis.editor = window.Wds.postEditor;\n\t\t\tthis.init();\n\t\t}\n\n\t\tinit() {\n\t\t\tthis.editor.addEventListener('autosave', () => this.refresh_analysis());\n\n\t\t\t$(document)\n\t\t\t\t.on('click', '.wds-refresh-analysis', (e) => this.handle_refresh_click(e))\n\n\t\t\t\t.on('click', '.wds-seo-analysis-container .wds-ignore', (e) => this.handle_ignore_click(e))\n\t\t\t\t.on('click', '.wds-seo-analysis-container .wds-unignore', (e) => this.handle_unignore_click(e))\n\n\t\t\t\t.on('click', '.wds-readability-analysis-container .wds-ignore', (e) => this.handle_ignore_click(e))\n\t\t\t\t.on('click', '.wds-readability-analysis-container .wds-unignore', (e) => this.handle_unignore_click(e))\n\n\t\t\t\t.on('input propertychange', '.wds-focus-keyword input', _.debounce((e) => this.handle_focus_keywords_change(e), 2000));\n\n\t\t\t$(window)\n\t\t\t\t.on('load', () => this.hook_meta_change_listener()) // Hook meta change listener as late as possible\n\t\t\t\t.on('load', () => this.handle_page_load());\n\t\t}\n\n\t\trefresh_analysis() {\n\t\t\tlet focusKeyword = MetaboxAnalysisHelper.get_focus_keyword();\n\n\t\t\treturn this.post('wds-analysis-get-editor-analysis', {\n\t\t\t\tpost_id: this.editor.get_data().post_id,\n\t\t\t\tis_dirty: this.editor.is_post_dirty() ? 1 : 0,\n\t\t\t\twds_title: MetaboxAnalysisHelper.get_title(),\n\t\t\t\twds_description: MetaboxAnalysisHelper.get_description(),\n\t\t\t\twds_focus_keywords: focusKeyword,\n\t\t\t}).done((response) => {\n\t\t\t\tif (!(response || {}).success) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tlet data = (response || {}).data,\n\t\t\t\t\tseo_report = (data || {}).seo || '',\n\t\t\t\t\treadability_report = (data || {}).readability || '',\n\t\t\t\t\tpost_fields = (data || {}).postbox_fields || '';\n\n\t\t\t\tMetaboxAnalysisHelper.replace_seo_report(seo_report);\n\t\t\t\tMetaboxAnalysisHelper.replace_readability_report(readability_report);\n\t\t\t\tMetaboxAnalysisHelper.replace_post_fields(post_fields);\n\n\t\t\t\tlet seo_errors = MetaboxAnalysisHelper.get_seo_error_count(),\n\t\t\t\t\treadability_state = MetaboxAnalysisHelper.get_readability_state();\n\n\t\t\t\tthis.dispatch_seo_update_event(seo_errors);\n\t\t\t\tthis.dispatch_readability_update_event(readability_state);\n\t\t\t}).always(() => {\n\t\t\t\tMetaboxAnalysisHelper.unblock_ui();\n\n\t\t\t\tlet focusValid = !!(focusKeyword && focusKeyword.length);\n\t\t\t\tMetaboxAnalysisHelper.update_focus_field_state(focusValid);\n\t\t\t\tMetaboxAnalysisHelper.update_refresh_button(true);\n\t\t\t});\n\t\t}\n\n\t\thandle_refresh_click(e) {\n\t\t\tthis.prevent_default(e);\n\t\t\tthis.dispatch_event('before-analysis-refresh');\n\t\t\tMetaboxAnalysisHelper.block_ui();\n\t\t\tthis.editor.autosave();\n\t\t}\n\n\t\thandle_ignore_click(e) {\n\t\t\tthis.prevent_default(e);\n\n\t\t\tlet $button = $(e.target).closest('button'),\n\t\t\t\tcheck_id = $button.attr('data-check_id');\n\n\t\t\tMetaboxAnalysisHelper.block_ui($button);\n\t\t\treturn this.change_ignore_status(check_id, true).done(() => this.refresh_analysis());\n\t\t}\n\n\t\thandle_unignore_click(e) {\n\t\t\tthis.prevent_default(e);\n\n\t\t\tlet $button = $(e.target).closest('button'),\n\t\t\t\tcheck_id = $button.attr('data-check_id');\n\n\t\t\tMetaboxAnalysisHelper.block_ui($button);\n\t\t\treturn this.change_ignore_status(check_id, false).done(() => this.refresh_analysis());\n\t\t}\n\n\t\thandle_focus_keywords_change() {\n\t\t\tthis.dispatch_event('before-focus-keyword-update');\n\n\t\t\tMetaboxAnalysisHelper.block_ui(MetaboxAnalysisHelper.get_focus_container_el());\n\t\t\tthis.refresh_analysis();\n\t\t}\n\n\t\thook_meta_change_listener() {\n\t\t\tlet metaboxOnpage = window.Wds.metaboxOnpage;\n\t\t\tif (metaboxOnpage) {\n\t\t\t\tmetaboxOnpage.addEventListener('meta-change', () => this.refresh_analysis());\n\t\t\t}\n\t\t}\n\n\t\thandle_page_load() {\n\t\t\tthis.dispatch_event('before-analysis-refresh');\n\t\t\tMetaboxAnalysisHelper.block_ui();\n\t\t\tthis.refresh_analysis();\n\t\t}\n\n\t\tpost(action, data) {\n\t\t\tdata = $.extend({\n\t\t\t\taction: action,\n\t\t\t\t_wds_nonce: _wds_metabox_analysis.nonce\n\t\t\t}, data);\n\n\t\t\treturn $.post(ajaxurl, data);\n\t\t}\n\n\t\tchange_ignore_status(check_id, ignore) {\n\t\t\tthis.dispatch_event('before-ignore-status-change');\n\n\t\t\tlet action = !!ignore\n\t\t\t\t? 'wds-analysis-ignore-check'\n\t\t\t\t: 'wds-analysis-unignore-check';\n\t\t\treturn this.post(action, {\n\t\t\t\tpost_id: this.editor.get_data().post_id,\n\t\t\t\tcheck_id: check_id,\n\t\t\t});\n\t\t}\n\n\t\tprevent_default(event) {\n\t\t\tif (event && event.preventDefault && event.stopPropagation) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\t\t\t}\n\t\t}\n\n\t\tdispatch_event(event) {\n\t\t\tthis.dispatchEvent(new Event(event));\n\t\t}\n\n\t\tdispatch_seo_update_event(error_count) {\n\t\t\tlet event = new CustomEvent('after-seo-analysis-update', {detail: {errors: error_count}});\n\t\t\tthis.dispatchEvent(event);\n\t\t}\n\n\t\tdispatch_readability_update_event(state) {\n\t\t\tlet event = new CustomEvent('after-readability-analysis-update', {detail: {state: state}});\n\t\t\tthis.dispatchEvent(event);\n\t\t}\n\t}\n\n\twindow.Wds.metaboxAnalysis = new MetaboxAnalysis();\n})(jQuery);\n"],"file":"wds-metabox-analysis.js"}