{"version":3,"sources":["../es6/wds-metabox-onpage.js"],"names":["$","window","Wds","MetaboxOnpageHelper","val","loading","$preview","get_preview_el","find","loading_class","addClass","removeClass","new_markup","replaceWith","placeholder","attr","MetaboxOnpage","editor","postEditor","init","addEventListener","e","handle_autosave_event","handle_content_change_event","document","on","_","debounce","handle_meta_change","handle_page_load","refresh_preview","refresh_placeholders","dispatch_meta_change_event","preview_loading","post","wds_title","get_title","wds_description","get_description","post_id","get_data","is_dirty","is_post_dirty","done","data","success","replace_preview_markup","markup","always","id","description","title","set_title_placeholder","set_desc_placeholder","dispatchEvent","Event","action","extend","_wds_nonce","_wds_metabox_onpage","nonce","ajaxurl","EventTarget","metaboxOnpage","jQuery"],"mappings":"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","sourcesContent":["(function ($) {\n\twindow.Wds = window.Wds || {};\n\n\tclass MetaboxOnpageHelper {\n\t\tstatic get_title() {\n\t\t\treturn $('#wds_title').val();\n\t\t}\n\n\t\tstatic get_description() {\n\t\t\treturn $('#wds_metadesc').val();\n\t\t}\n\n\t\tstatic preview_loading(loading) {\n\t\t\tlet $preview = this.get_preview_el().find('.wds-preview-container'),\n\t\t\t\tloading_class = 'wds-preview-loading';\n\n\t\t\tif (loading) {\n\t\t\t\t$preview.addClass(loading_class);\n\t\t\t} else {\n\t\t\t\t$preview.removeClass(loading_class);\n\t\t\t}\n\t\t}\n\n\t\tstatic get_preview_el() {\n\t\t\treturn $('.wds-metabox-preview');\n\t\t}\n\n\t\tstatic replace_preview_markup(new_markup) {\n\t\t\tthis.get_preview_el().replaceWith(new_markup)\n\t\t}\n\n\t\tstatic set_title_placeholder(placeholder) {\n\t\t\t$('#wds_title').attr('placeholder', placeholder);\n\t\t}\n\n\t\tstatic set_desc_placeholder(placeholder) {\n\t\t\t$('#wds_metadesc').attr('placeholder', placeholder);\n\t\t}\n\t}\n\n\tclass MetaboxOnpage extends EventTarget {\n\t\tconstructor() {\n\t\t\tsuper();\n\n\t\t\tthis.editor = window.Wds.postEditor;\n\t\t\tthis.init();\n\t\t}\n\n\t\tinit() {\n\t\t\tthis.editor.addEventListener('autosave', (e) => this.handle_autosave_event(e));\n\t\t\tthis.editor.addEventListener('content-change', (e) => this.handle_content_change_event(e));\n\n\t\t\t$(document)\n\t\t\t\t.on('input propertychange', '.wds-meta-field', _.debounce((e) => this.handle_meta_change(e), 2000));\n\n\t\t\t$(window)\n\t\t\t\t.on('load', () => this.handle_page_load());\n\t\t}\n\n\t\thandle_autosave_event() {\n\t\t\tthis.refresh_preview();\n\t\t\tthis.refresh_placeholders();\n\t\t}\n\n\t\thandle_content_change_event() {\n\t\t\tthis.refresh_preview();\n\t\t\tthis.refresh_placeholders();\n\t\t}\n\n\t\thandle_meta_change() {\n\t\t\tthis.dispatch_meta_change_event();\n\t\t\tthis.refresh_preview();\n\t\t}\n\n\t\thandle_page_load() {\n\t\t\tthis.refresh_preview();\n\t\t\tthis.refresh_placeholders();\n\t\t}\n\n\t\trefresh_preview() {\n\t\t\tMetaboxOnpageHelper.preview_loading(true);\n\n\t\t\tthis.post('wds-metabox-preview', {\n\t\t\t\twds_title: MetaboxOnpageHelper.get_title(),\n\t\t\t\twds_description: MetaboxOnpageHelper.get_description(),\n\t\t\t\tpost_id: this.editor.get_data().post_id,\n\t\t\t\tis_dirty: this.editor.is_post_dirty() ? 1 : 0,\n\t\t\t}).done(function (data) {\n\t\t\t\tdata = (data || {});\n\n\t\t\t\tif (data.success) {\n\t\t\t\t\tMetaboxOnpageHelper.replace_preview_markup(data.markup);\n\t\t\t\t}\n\t\t\t}).always(function () {\n\t\t\t\tMetaboxOnpageHelper.preview_loading(false);\n\t\t\t});\n\t\t}\n\n\t\trefresh_placeholders() {\n\t\t\tthis.post('wds_metabox_update', {\n\t\t\t\tid: this.editor.get_data().post_id,\n\t\t\t\tpost: this.editor.get_data(),\n\t\t\t}).done(function (data) {\n\t\t\t\tdata = data || {};\n\t\t\t\tlet description = (data).description || '',\n\t\t\t\t\ttitle = (data).title || '';\n\n\t\t\t\tMetaboxOnpageHelper.set_title_placeholder(title);\n\t\t\t\tMetaboxOnpageHelper.set_desc_placeholder(description);\n\t\t\t});\n\t\t}\n\n\t\tdispatch_meta_change_event() {\n\t\t\tthis.dispatchEvent(new Event('meta-change'));\n\t\t}\n\n\t\tpost(action, data) {\n\t\t\tdata = $.extend({\n\t\t\t\taction: action,\n\t\t\t\t_wds_nonce: _wds_metabox_onpage.nonce\n\t\t\t}, data);\n\n\t\t\treturn $.post(ajaxurl, data);\n\t\t}\n\t}\n\n\twindow.Wds.metaboxOnpage = new MetaboxOnpage();\n})(jQuery);\n"],"file":"wds-metabox-onpage.js"}