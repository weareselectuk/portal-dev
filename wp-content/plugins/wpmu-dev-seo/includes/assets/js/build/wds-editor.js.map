{"version":3,"sources":["../es6/wds-editor.js"],"names":["$","window","Wds","GutenbergEditor","init","hook_change_listener","register_api_fetch_middleware","fields","data","forEach","field","get_editor","getEditedPostAttribute","replace","post_id","val","wp","select","dispatchEvent","Event","dispatch","debounced","_","debounce","dispatch_content_change_event","subscribe","isEditedPostDirty","isAutosavingPost","isSavingPost","apiFetch","use","options","next","result","then","is_autosave_request","is_post_save_request","dispatch_autosave_event","request","path","includes","post","get_data","post_type","method","isEditedPostAutosaveable","dispatch_editor","autosave","EventTarget","postEditor","jQuery"],"mappings":"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","sourcesContent":["(function ($) {\n\twindow.Wds = window.Wds || {};\n\n\tclass GutenbergEditor extends EventTarget {\n\t\tconstructor() {\n\t\t\tsuper();\n\n\t\t\tthis.init();\n\t\t}\n\n\t\tinit() {\n\t\t\tthis.hook_change_listener();\n\t\t\tthis.register_api_fetch_middleware();\n\t\t}\n\n\t\tget_data() {\n\t\t\tlet fields = ['content', 'excerpt', 'post_author', 'post_id', 'post_title', 'post_type'],\n\t\t\t\tdata = {};\n\n\t\t\tfields.forEach((field) => {\n\t\t\t\tdata[field] = this.get_editor().getEditedPostAttribute(field.replace('post_', '')) || '';\n\t\t\t});\n\n\t\t\tif (!data.post_id) {\n\t\t\t\tdata.post_id = $('#post_ID').val() || 0;\n\t\t\t}\n\n\t\t\treturn data;\n\t\t}\n\n\t\tget_editor() {\n\t\t\treturn wp.data.select(\"core/editor\");\n\t\t}\n\n\t\tdispatch_content_change_event() {\n\t\t\tthis.dispatchEvent(new Event('content-change'));\n\t\t}\n\n\t\tdispatch_editor() {\n\t\t\treturn wp.data.dispatch(\"core/editor\");\n\t\t}\n\n\t\thook_change_listener() {\n\t\t\tlet debounced = _.debounce(() => this.dispatch_content_change_event(), 10000);\n\n\t\t\twp.data.subscribe(() => {\n\t\t\t\tif (\n\t\t\t\t\tthis.get_editor().isEditedPostDirty()\n\t\t\t\t\t&& !this.get_editor().isAutosavingPost()\n\t\t\t\t\t&& !this.get_editor().isSavingPost()\n\t\t\t\t) {\n\t\t\t\t\tdebounced();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tregister_api_fetch_middleware() {\n\t\t\tif (!(wp || {}).apiFetch) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\twp.apiFetch.use((options, next) => {\n\t\t\t\tlet result = next(options);\n\t\t\t\tresult.then(() => {\n\t\t\t\t\tif (this.is_autosave_request(options) || this.is_post_save_request(options)) {\n\t\t\t\t\t\tthis.dispatch_autosave_event();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn result;\n\t\t\t});\n\t\t}\n\n\t\tdispatch_autosave_event() {\n\t\t\tthis.dispatchEvent(new Event('autosave'));\n\t\t}\n\n\t\tis_autosave_request(request) {\n\t\t\treturn request && request.path\n\t\t\t\t&& request.path.includes('/autosaves');\n\t\t}\n\n\t\tis_post_save_request(request) {\n\t\t\tlet post = this.get_data(),\n\t\t\t\tpost_id = post.post_id,\n\t\t\t\tpost_type = post.post_type;\n\n\t\t\treturn request && request.path\n\t\t\t\t&& request.method === 'PUT'\n\t\t\t\t&& request.path.includes('/' + post_id)\n\t\t\t\t&& request.path.includes('/' + post_type);\n\t\t}\n\n\t\tautosave() {\n\t\t\t// TODO: Keep track of this error: https://github.com/WordPress/gutenberg/issues/7416\n\t\t\tif (this.get_editor().isEditedPostAutosaveable()) {\n\t\t\t\tthis.dispatch_editor().autosave();\n\t\t\t} else {\n\t\t\t\tthis.dispatch_autosave_event();\n\t\t\t}\n\t\t}\n\n\t\tis_post_dirty() {\n\t\t\treturn this.get_editor().isEditedPostDirty();\n\t\t}\n\t}\n\n\twindow.Wds.postEditor = new GutenbergEditor();\n})(jQuery);\n"],"file":"wds-editor.js"}