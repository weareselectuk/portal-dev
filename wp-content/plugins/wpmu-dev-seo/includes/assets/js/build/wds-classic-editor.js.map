{"version":3,"sources":["../es6/wds-classic-editor.js"],"names":["$","window","Wds","ClassicEditor","init","document","on","get_debounced_change_callback","dispatch_autosave_event","hook_tinymce_change_listener","wp","autosave","getPostData","dispatchEvent","Event","editor","tinymce","get","_","debounce","dispatch_content_change_event","handle_heartbeat","off","one","trigger_tinymce_save","server","triggerSave","editorSync","tinyMCE","postChanged","EventTarget","postEditor","jQuery"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,CAAC,UAAUA,CAAV,EAAa;AACbC,EAAAA,MAAM,CAACC,GAAP,GAAaD,MAAM,CAACC,GAAP,IAAc,EAA3B;;AADa,MAGPC,aAHO;AAAA;AAAA;AAAA;;AAIZ,6BAAc;AAAA;;AAAA;;AACb;;AAEA,YAAKC,IAAL;;AAHa;AAIb;;AARW;AAAA;AAAA,6BAUL;AAAA;;AACNJ,QAAAA,CAAC,CAACK,QAAD,CAAD,CACEC,EADF,CACK,OADL,EACc,+CADd,EAC+D,KAAKC,6BAAL,EAD/D,EAEED,EAFF,CAEK,2BAFL,EAEkC;AAAA,iBAAM,MAAI,CAACE,uBAAL,EAAN;AAAA,SAFlC;AAIAR,QAAAA,CAAC,CAACC,MAAD,CAAD,CACEK,EADF,CACK,MADL,EACa;AAAA,iBAAM,MAAI,CAACG,4BAAL,EAAN;AAAA,SADb;AAEA;AAjBW;AAAA;AAAA,iCAmBD;AACV,eAAOC,EAAE,CAACC,QAAH,CAAYC,WAAZ,EAAP;AACA;AArBW;AAAA;AAAA,sDAuBoB;AAC/B,aAAKC,aAAL,CAAmB,IAAIC,KAAJ,CAAU,gBAAV,CAAnB;AACA;AAzBW;AAAA;AAAA,qDA2BmB;AAC9B,YAAIC,MAAM,GAAG,OAAOC,OAAP,KAAmB,WAAnB,IAAkCA,OAAO,CAACC,GAAR,CAAY,SAAZ,CAA/C;;AACA,YAAIF,MAAJ,EAAY;AACXA,UAAAA,MAAM,CAACT,EAAP,CAAU,QAAV,EAAoB,KAAKC,6BAAL,EAApB;AACA;AACD;AAhCW;AAAA;AAAA,sDAkCoB;AAAA;;AAC/B,eAAOW,CAAC,CAACC,QAAF,CAAW;AAAA,iBAAM,MAAI,CAACC,6BAAL,EAAN;AAAA,SAAX,EAAuD,IAAvD,CAAP;AACA;AApCW;AAAA;AAAA,gDAsCc;AACzB,aAAKP,aAAL,CAAmB,IAAIC,KAAJ,CAAU,UAAV,CAAnB;AACA;AAED;;;;;;;;AA1CY;AAAA;AAAA,iCAiDD;AAAA;;AACV,YAAIO,gBAAgB,GAAG,SAAnBA,gBAAmB,GAAM;AAC5B,UAAA,MAAI,CAACb,uBAAL,GAD4B,CAG5B;;;AACAR,UAAAA,CAAC,CAACK,QAAD,CAAD,CAAYC,EAAZ,CAAe,2BAAf,EAA4C;AAAA,mBAAM,MAAI,CAACE,uBAAL,EAAN;AAAA,WAA5C;AACA,SALD,CADU,CAQV;;;AACAR,QAAAA,CAAC,CAACK,QAAD,CAAD,CAAYiB,GAAZ,CAAgB,2BAAhB,EATU,CAUV;;AACAtB,QAAAA,CAAC,CAACK,QAAD,CAAD,CAAYkB,GAAZ,CAAgB,yBAAhB,EAA2CF,gBAA3C,EAXU,CAaV;;AACA,aAAKG,oBAAL,GAdU,CAeV;;AACAd,QAAAA,EAAE,CAACC,QAAH,CAAYc,MAAZ,CAAmBC,WAAnB;AACA;AAlEW;AAAA;AAAA,6CAoEW;AACtB,YAAIC,UAAU,GAAG,CAACC,OAAO,IAAI,EAAZ,EAAgBF,WAAjC;;AACA,YAAIC,UAAJ,EAAgB;AACfA,UAAAA,UAAU;AACV;AACD;AAzEW;AAAA;AAAA,sCA2EI;AACf,eAAOjB,EAAE,CAACC,QAAH,CAAYc,MAAZ,CAAmBI,WAAnB,EAAP;AACA;AA7EW;;AAAA;AAAA,qBAGeC,WAHf;;AAgFb7B,EAAAA,MAAM,CAACC,GAAP,CAAW6B,UAAX,GAAwB,IAAI5B,aAAJ,EAAxB;AACA,CAjFD,EAiFG6B,MAjFH","sourcesContent":["(function ($) {\n\twindow.Wds = window.Wds || {};\n\n\tclass ClassicEditor extends EventTarget {\n\t\tconstructor() {\n\t\t\tsuper();\n\n\t\t\tthis.init();\n\t\t}\n\n\t\tinit() {\n\t\t\t$(document)\n\t\t\t\t.on('input', 'input#title,textarea#content,textarea#excerpt', this.get_debounced_change_callback())\n\t\t\t\t.on('after-autosave.smartcrawl', () => this.dispatch_autosave_event());\n\n\t\t\t$(window)\n\t\t\t\t.on('load', () => this.hook_tinymce_change_listener());\n\t\t}\n\n\t\tget_data() {\n\t\t\treturn wp.autosave.getPostData();\n\t\t}\n\n\t\tdispatch_content_change_event() {\n\t\t\tthis.dispatchEvent(new Event('content-change'));\n\t\t}\n\n\t\thook_tinymce_change_listener() {\n\t\t\tlet editor = typeof tinymce !== 'undefined' && tinymce.get('content');\n\t\t\tif (editor) {\n\t\t\t\teditor.on('change', this.get_debounced_change_callback());\n\t\t\t}\n\t\t}\n\n\t\tget_debounced_change_callback() {\n\t\t\treturn _.debounce(() => this.dispatch_content_change_event(), 2000);\n\t\t}\n\n\t\tdispatch_autosave_event() {\n\t\t\tthis.dispatchEvent(new Event('autosave'));\n\t\t}\n\n\t\t/**\n\t\t * When the classic editor is active and we trigger an autosave programmatically,\n\t\t * the heartbeat API is used for the autosave.\n\t\t *\n\t\t * To provide a seamless experience, this method temporarily removes our usual handler\n\t\t * and hooks a handler to the heartbeat event.\n\t\t */\n\t\tautosave() {\n\t\t\tlet handle_heartbeat = () => {\n\t\t\t\tthis.dispatch_autosave_event();\n\n\t\t\t\t// Re-hook our regular autosave handler\n\t\t\t\t$(document).on('after-autosave.smartcrawl', () => this.dispatch_autosave_event());\n\t\t\t};\n\n\t\t\t// We are already hooked to autosave so let's disable our regular autosave handler momentarily to avoid multiple calls ...\n\t\t\t$(document).off('after-autosave.smartcrawl');\n\t\t\t// hook a new handler to heartbeat-tick.autosave\n\t\t\t$(document).one('heartbeat-tick.autosave', handle_heartbeat);\n\n\t\t\t// Save any changes pending in the editor to the textarea\n\t\t\tthis.trigger_tinymce_save();\n\t\t\t// Actually trigger the autosave\n\t\t\twp.autosave.server.triggerSave();\n\t\t}\n\n\t\ttrigger_tinymce_save() {\n\t\t\tlet editorSync = (tinyMCE || {}).triggerSave;\n\t\t\tif (editorSync) {\n\t\t\t\teditorSync();\n\t\t\t}\n\t\t}\n\n\t\tis_post_dirty() {\n\t\t\treturn wp.autosave.server.postChanged();\n\t\t}\n\t}\n\n\twindow.Wds.postEditor = new ClassicEditor();\n})(jQuery);\n"],"file":"wds-classic-editor.js"}