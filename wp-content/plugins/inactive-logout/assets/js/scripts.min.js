/*!
 * Deepen - Inactive Logout v1.8.0
 * Copyright 2019-2019 Deepen Bajracharya
 */

var inactive_logout_timeoutID,inactive_logout_tabID,inactive_logout_timeoutMessage,ina_timeout=ina_meta_data.ina_timeout,ina_timeout_defined=1e3*ina_timeout,ina_messageBox=0;function ina__setup_theforce_awakens(){this.addEventListener("mousemove",ina__resetTimer,!1),this.addEventListener("mousedown",ina__resetTimer,!1),this.addEventListener("keypress",ina__resetTimer,!1),this.addEventListener("DOMMouseScroll",ina__resetTimer,!1),this.addEventListener("mousewheel",ina__resetTimer,!1),this.addEventListener("touchmove",ina__resetTimer,!1),this.addEventListener("MSPointerMove",ina__resetTimer,!1),inactive_logout_tabID=sessionStorage.inactive_logout_tabID&&"2"!==sessionStorage.closedLastTab?sessionStorage.inactive_logout_tabID:sessionStorage.inactive_logout_tabID=Math.random(),sessionStorage.closedLastTab="2",jQuery(window).on("unload beforeunload",function(){sessionStorage.closedLastTab="1"}),localStorage.setItem("ina__browserTabID",inactive_logout_tabID),ina__startTimer()}function ina__startTimer(){inactive_logout_timeoutID=window.setTimeout(ina__goInactive,11e3)}function ina__resetTimer(e){window.clearTimeout(inactive_logout_timeoutID),window.clearTimeout(inactive_logout_timeoutMessage),localStorage.setItem("ina__browserTabID",inactive_logout_tabID),ina__goActive()}function ina__goInactive(){if(0==ina_messageBox){var e=Date.now(),n=Math.floor(e/1e3);jQuery(document).ready(function(e){var o={action:"ina_checklastSession",do:"ina_updateLastSession",security:ina_ajax.ina_security,timestamp:n};e.post(ina_ajax.ajaxurl,o).done(function(e){var o=document.activeElement;o&&"IFRAME"==o.tagName&&ina__resetTimer(),localStorage.getItem("ina__browserTabID")==inactive_logout_tabID&&(inactive_logout_timeoutMessage=window.setTimeout(ina__showTimeoutMessage,ina_timeout_defined))})})}}function ina__showTimeoutMessage(){var t,i=10,_=ina_meta_data.ina_disable_countdown,s=ina_meta_data.ina_warn_message_enabled;jQuery(function(o){if(document.onkeydown=function(e){if(116!=(e.charCode||e.keyCode))return!1},window.oncontextmenu=function(){return!1},o(".ina__no_confict_popup_bg").data("bgenabled")){var e=o(".ina__no_confict_popup_bg").data("bg");o("#ina__dp_logout_message_box").css("background",e)}if(ina_messageBox=1,s)o("#ina__dp_logout_message_box").show(),o(".ina_stay_logged_in").click(function(){document.onkeydown=function(e){return!0},window.oncontextmenu=null,o("#ina__dp_logout_message_box").hide(),ina_messageBox=0});else if(_){var n={action:"ina_checklastSession",do:"ina_logout",security:ina_ajax.ina_security};o.post(ina_ajax.ajaxurl,n).done(function(e){return e.redirect_url?(o("#ina__dp_logout_message_box").show(),o("#ina__dp_logout_message_box .ina-dp-noflict-modal-body").html("<p>"+e.msg+"<p>"),ina__logout_now(e.redirect_url)):(o("#ina__dp_logout_message_box").show(),o("#ina__dp_logout_message_box .ina-dp-noflict-modal-body").html("<p>"+e.msg+'<p><p class="ina-dp-noflict-btn-container"><a class="btn-timeout" href="javascript:void(0);" onclick="window.location.reload();">OK</a></p>'),ina__logout_now(!1)),!1})}else{o("#ina__dp_logout_message_box").show();var a=setInterval(function(){if(0<=i&&(t=i--,o(".ina_countdown").html("("+t+")")),0==t){clearTimeout(a);var e={action:"ina_checklastSession",do:"ina_logout",security:ina_ajax.ina_security};o.post(ina_ajax.ajaxurl,e).done(function(e){return e.redirect_url?(o("#ina__dp_logout_message_box .ina-dp-noflict-modal-body").html("<p>"+e.msg+"<p>"),ina__logout_now(e.redirect_url)):(o("#ina__dp_logout_message_box .ina-dp-noflict-modal-body").html("<p>"+e.msg+'<p><p class="ina-dp-noflict-btn-container"><a class="btn-timeout" href="javascript:void(0);" onclick="window.location.reload();">OK</a></p>'),ina__logout_now(!1)),!1})}},1e3);o(".ina_stay_logged_in").click(function(){document.onkeydown=function(e){return!0},window.oncontextmenu=null,clearTimeout(a),i=10,ina_messageBox=0,o("#ina__dp_logout_message_box").hide(),o(".ina_countdown").text("")})}})}function ina__goActive(){ina__startTimer()}function ina__logout_now(e){$=jQuery;var o={action:"ina_logout_session",security:ina_ajax.ina_security};$.post(ina_ajax.ajaxurl,o).done(function(){e&&(window.location=e),console.log("Session Logged Out !!")})}ina__setup_theforce_awakens();